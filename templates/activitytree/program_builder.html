{% extends 'activitytree/base.html' %}



{% block style %}

/*
 * Editor
 */

    #editor1 {

        height: 340px;
        width: 600px;

    }

    #editor2{

        height: 340px;
        width: 600px;

    }

 p.test_error, p.test_failure {
    color:#d9534f;
    }

 p.test_success{
    color:#5cb85c;
    }

  .alert{
    margin:10px;
    margin-bottom:0px;
    }


{% endblock style %}



{% block content %}

<div class="container">
  <h3>Menu</h3>
  <ul class="nav nav-tabs">
    <li class="active"><a href="#inicio" data-toggle="tab">Inicio</a></li>
    <li><a href="#info" data-toggle="tab">Info</a> </li>
    <li><a href="#programa" data-toggle="tab">Programa</a></li>
  </ul>
  <br>

    <div class="tab-content">
        <div class="tab-pane fade in active" id="inicio">
            <div class="container-fluid">
                <h3>Inicio</h3>
                <p> Dar de alta actividades con ejercicios de programacion</p>
            </div>
        </div>

        <div class="tab-pane fade" id="info">
            <div class="container-fluid" style="float: left; width: 400px">
            <form id="formaProg" class="form-group" onsubmit="return false">
                <input type="hidden" id="txtId" name="_id" value="">
                <label for="txtLang">Elija lenguaje de programacion:</label>
                <select id="txtLang" name="lang" class="form-control">
                    <option value="javascript">Javascript</option>
                    <option value="csharp">Csharp</option>
                    <option value="python">Python</option>
                    <option value="java">Java</option>
                </select>
                <label for="txtTitle">Ingrese titulo de actividad:</label>
                <input type="text" class="form-control" id="txtTitle" name="title" placeholder="Titulo">
                <label for="txtDescripcion">Ingrese descripcion de actividad:</label>
                <input type="text" class="form-control" id="txtDescripcion" name="description" placeholder="Descripcion">
                <label for="txtInstrucciones">Ingrese las instrucciones de la actividad: </label>
                <textarea class="form-control" id="txtInstrucciones" name="instructions" rows="3"></textarea>
                <input type="hidden" name="type" value="prog">
                <input type="hidden" name="author" value="{{ user.email }}">
                <input type="hidden" name="icon" value="coffee"><br>
                <input type="submit" class="btn btn-primary" id="submitProg" value="Aceptar">
                <input type="button" class="btn btn-default" id="cancelProg" value="Cancelar">
            </form>
            </div>
            <div class="" style="margin-left: 400px">
                <label for="editor1">Ingrese la version de codigo correcta</label>
                <div class="myeditor" id="editor1">
function foo(items) {
var x = "Ejemplo";
return x;}
                </div>
                <input type="button" id="probarProg" class="btn btn-default" value="Probar">
                <input type="button" id="borrarProg" class="btn btn-default" value="Borrar">
            </div>
        </div>



        <div class="tab-pane fade" id="programa">
            <label for="editor2">Ingrese la version de codigo incorrecta</label>
            <div class="myeditor" id="editor2">
function foo(items) {

return x;}
            </div>
        </div>
    </div>
</div>

<div id="confirmProg" class="modal fade">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header" align="center">
            Confirmar <i class="fa fa-upload"></i>
        </div>
        <div class="modal-body">
            Seguro que quieres subir la actividad?
        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-primary" id="acceptBtn">Aceptar</button>
            <button type="button" data-dismiss="modal" class="btn">Cancelar</button>
        </div>
    </div>
</div>
</div>


{% endblock %}


{% block scripts %}

    <script>
    $(document).ready(function(){
        editor = ace.edit("editor1");
        codigo = editor.getValue();
        //editor.session.getUndoManager().markClean();
    });


    $(function(){
        var editor;
        $('.myeditor').each(function(){
            editor = ace.edit(this.id);
            editor.setTheme("ace/theme/chrome");
            editor.getSession().setMode('ace/mode/javascript');
        });

        $('#submitProg').click(function(e){

            var val = check(e);
            if (val == true){
                $("#confirmProg").modal();
            }
            else {

            }
        });

        $('#acceptBtn').click(function(e){
            submitProg()
        });

        $('#txtLang').on('change', function(){
            var lang = this.value;
            $('.myeditor').each(function(){
                editor = ace.edit(this.id);
                editor.setTheme("ace/theme/chrome");
                editor.getSession().setMode('ace/mode/'+ lang);
            });
        });

        $('#probarProg').click(function(){
            var editor = ace.edit("editor1");
            var codigo = editor.getValue();
            //var change = editor.session.getUndoManager().isClean();
            console.log(codigo)
        });

        $('#borrarProg').click(function(){
            var editor = ace.edit("editor1");
            editor.setValue(codigo);
        })

    });

    function check(e){
        var isValid = true;
            $('#formaProg input[type="text"]').each(function () {
                if ($.trim($(this).val()) == '') {
                    isValid = false;
                    $(this).css({
                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                }
                else {
                    $(this).css({
                        "border": "",
                        "background": ""
                    });
                }
            });

            if (isValid == false){
                e.preventDefault();
                return false;
                }
            else {
                return true
        }
    }

    function submitProg(){
        var data= $('#formaProg').serializeArray();
        var obj = progData();
        data.push(obj.obj1,obj.obj2);
        data=indexdata(data);
        $.ajax({
            type: 'post',
            url: '/upload_activity',
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (data) {
                if (data == 'Duplicate'){
                     alert("Error. Intente otro nombre para su actividad");
                }
                else{
                    alert("Actividad agregada");
                    $('#formaProg')[0].reset();
                    console.log(data);
                    window.location.href = "http://localhost:8000/build_program";
                }
            },
            error: function(data) {

                alert("Error. La actividad no se agrego")

            }
        });

    }

    function progData(){
        var editor = ace.edit("editor1");
        var editor2 = ace.edit("editor2");
        var obj1={
            'name': 'correct_code',
            'value': editor.getValue()
        };
        var obj2={
              'name': 'initial_code',
            'value': editor2.getValue()
        };

        return {obj1:obj1,obj2:obj2}

    }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/ace.js " type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/theme-github.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/snippets/javascript.js" type="text/javascript" charset="utf-8"></script>


{% endblock %}