{% extends "activitytree/base.html" %}

{% block style %}

/*
 * Editor
 */
    .bootstrap-timepicker-widget.dropdown-menu {
    z-index: 1050!important;
}


    #editor1 {

        height: 340px;
        width: 200;


    }

 p.test_error, p.test_failure {
    color:#d9534f;
    }

 p.test_success{
    color:#5cb85c;
    }

  .alert{
    margin:10px;
    margin-bottom:0px;
    }


{% endblock style %}




{% block content %}

    <h3 >  {{ course_name }}                 <small id="course-url"> {{ course_uri }}  </small>  </h3>

    <ol class="breadcrumb">
  <li class="breadcrumb-item"><a href="/instructor">Mis Cursos</a></li>
  <li id="course-title" class="breadcrumb-item active">{{ course_name }} <small id="course-url"> {{ course_uri }}  </small> </li>
</ol>

    <nav class="navbar navbar-default">
      <div class="container-fluid">

        <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="row instructor-tab" >
                <nav class="navbar navbar-light bg-faded">
                    <ul class="nav navbar-nav">
                     <li class="nav-item"> <button id="newContainerBtn" class="btn btn-primary">New Container</button></li>
                     <li class="nav-item"> <button id="newActivityBtn" class="btn btn-primary">New Activity</button></li>
                     <li class="nav-item"> <button id="saveChangesBtn" class="btn btn-primary">Save </button></li>
                     <li class="nav-item"> <button id="exportBtn" class="btn btn-primary">Export to File </button></li>
                     <li class="nav-item"> <button id="uploadBtn" class="btn btn-primary">Upload</button></li>
                    </ul>
                    <ul class="nav navbar-nav  pull-xs-right">
                     <li class="nav-item"> <button id="courseSettingsBtn" class="btn btn-primary"><i class="fa fa-cog"></i></button></li>
                     <li class="nav-item"> <button id="courseCalendarBtn" class="btn btn-primary"><i class="fa fa-calendar"></i></button></li>
                     <li class="nav-item"> <button id="courseDeleteBtn" class="btn btn-primary"><i class="fa fa-trash-o"></i> </button></li>
                    </ul>
                </nav>
             </div>

       <!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <ul class="sTree2 listsClass" id="sTree2">



    </ul>

    <section>
      <p>Don't forget to <strong> Save </strong> changes.</p>
        </section>



{% endblock content %}

{% block scripts %}
<script src="http://gdriv.es/proto/bootstrap-timepicker3.min.js" type="text/javascript"></script>
 <script async="" src="{{ STATIC_URL }}app/scripts/FileSaver.min.js"/>

<script id="activities_template" type="x-tmpl-mustache">
         <div class="panel panel-default container-fluid" style="width:500px">
            <div class="panel-heading row">
            <div class="col-xs-15 text-right">
                    <button type="button" value="[[id]]" onclick='copyUri("[[id]]","[[title]]")' data-toggle="" data-target="#"  data-href="[[id]]" class="btn btn-default clickable   editBtn"><i class="fa fa-plus clickable clipBtn"></i> </button>
            </div>
                <p style='line-height: 10px'>
                <a href="#" onclick='javascript:window.open("[[id]]", "_blank", "scrollbars=1,resizable=1,height=600,width=650");' class=""><i class="fa fa-[[icon]] fa-lg" style='vertical-align:middle'> [[title]] </i></a>
            </div>
             <div class="panel-body">

               [[#description]]
                    <b>Descripcion: [[description]]
               [[ /description ]]
               [[^description]]
                    <b>Sin descripcion</b>
               [[/description]]

            <p>
              <span class="label label-info"><a href="/search/?type=[[type]]" style="color:#FFFFFF">[[type]]</a></span>
              [[#lang]]
              <span class="label label-success"><a href="/search/?lang=[[lang]]" style="color:#FFFFFF">[[lang]]</a></span>
              [[/lang]]
              [[^lang]]
              [[/lang]]
              <span class="label label-default"><a href="/search/?level=[[level]]" style="color:#FFFFFF">[[level]]</a></span><br>
              [[#tags]]
              [[#.]]
              <span class="label label-info"><a href="/search/?tag=[[.]]" style="color:#FFFFFF">[[.]]</a></span>
              [[/.]]
              [[^.]]
              [[/.]]
              [[/tags]]
            </p>
            </div>
            </div>
</script>



<script id="container_template" type="x-tmpl-mustache">

        <li id="[[ container_id  ]]"  data-module="container">


          <div>

<div class="btn-group">
 <button type="button" class="btn btn-secondary dropdown-toggle clickable" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
     <span class="container_name"> [[container_name]]</span>

  </button>
  <div class="dropdown-menu">

      <button type="button" class="dropdown-item clickable   containerEditBtn"><i class="fa fa-cog clickable containerEditBtn"></i> Settings</button>
     <button type="button" class="dropdown-item clickable   activityEditBtn">Advanced</button>
     <button type="button" class="dropdown-item clickable   containerPrecondition">Rules</button>
     <button type="button" class="dropdown-item clickable   containerFromUntil"><i class="fa fa-calendar  clickable  containerFromUnti"></i> Dates</button>
     <button type="button" class="dropdown-item danger  clickable  deleteBtn"><i class="fa fa-trash-o clickable"></i> Delete</button>
  </div>
</div>

      </div>



 </li>

</script>


<script id="activity_template" type="x-tmpl-mustache">

 <li id="[[ activity_id  ]]"  data-module="activity" class="activity">
<div>

<div class="btn-group">
 <button type="button" class="btn btn-primary dropdown-toggle clickable" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-file"></i> <span class="container_name">[[activity_name]] </span>
  </button>
  <div class="dropdown-menu">

     <button type="button" class="dropdown-item clickable   containerSearch"><i class="fa fa-search  clickable  containerSearch"></i> Search activity</button>
     <button type="button" class="dropdown-item clickable   containerEditBtn"><i class="fa fa-cog clickable containerEditBtn"></i> Settings</button>
     <button type="button" class="dropdown-item clickable   activityEditBtn">Advanced</button>
     <button type="button" class="dropdown-item clickable   containerPrecondition">Rules</button>
     <button type="button" class="dropdown-item clickable   containerFromUntil"><i class="fa fa-calendar  clickable  containerFromUnti"></i> Dates</button>
     <button type="button" class="dropdown-item danger  clickable  deleteBtn"><i class="fa fa-trash-o clickable"></i> Delete</button>
  </div>
</div>

</div>
 </li>

</script>


<script id="rules_template" type="x-tmpl-mustache">

            <div class="inline" id="rule" container="[[container_id]]">

                [[#condiciones]]

                <div id="[[id]]" style="border-bottom:2px dashed #EEEEEE;padding-bottom:2%;margin-bottom:2.5%;margin-left:3%;margin-top:2.5%;text-align:left;margin-right:3%">
                [[#user]]<b> User </b> [[/user]] [[^user]] <b> [[act_name]] </b> [[/user]]<em> has [[option_txt]]</em> <b>[[operator_txt]]</b> [[value]] </span>

                <button type="button" condition-id="[[id]]" class="btn btn-danger deleteRuleBtn" style="float:right;margin-left:5px">Remove</button>
                </div>
                [[/condiciones]]

                <span id="span-rule" style="font-size: medium"></span>
                <div class="form-inline" id="then-condition">
                    <div>
                    <br>
                        <label for="precondition-select"><em>Then</em> <b>Pre-Condition</b> is:  </label>
                        <select id="precondition-select" class="form-control selectThen" container="[[container_id]]" style="width:25%">
                            <option value=""></option>
                            <option value="skip">Skip</option>
                            <option value="stopForwardTraversal">Stop Forward Traversal</option>
                            <option value="disabled">Disabled</option>
                            <option value="enabled">Enabled</option>
                        </select>
                    </div>
                </div><br>


</script>


<!-- endbuild -->

<script>

     Mustache.tags = ['[[', ']]'];

    var Wait;
    Wait = Wait || (function () {
    var pleaseWaitDiv = $('<div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Processing...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');
    return {
        show: function() {
            pleaseWaitDiv.modal();
        },
        hide: function () {
            pleaseWaitDiv.modal('hide');
        },
    };
})();



  function generateUUID() {
    var d = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      var r = (d + Math.random() * 16) % 16 | 0;
      d = Math.floor(d / 16);
      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
    return uuid;
  }

</script>

 <script src="{{ STATIC_URL }}app/scripts/main.js"></script>

<script type="text/javascript">
  $(function()
  {
      var options = {
      placeholderCss: {'background-color': '#ff8'},
      hintCss: {'background-color':'#bbf'},
      isAllowed: function(cEl, hint, target)
      {
        // Be carefull if you test some ul/ol elements here.
        // Sometimes ul/ols are dynamically generated and so they have not some attributes as natural ul/ols.
        // Be careful also if the hint is not visible. It has only display none so it is at the previouse place where it was before(excluding first moves before showing).
        if(hint.parents('li').first().data('module') === 'activity')
        {
          hint.css('background-color', '#ff9999');
          return false;
        }
        else
        {
          hint.css('background-color', '#99ff99');
          return true;
        }
      },
      opener: {
        active: true,
        close: './images/Remove2.png',
        open: './images/Add2.png',
        openerCss: {
          'display': 'inline-block',
          'width': '18px',
          'height': '18px',
          'float': 'left',
          'margin-left': '-35px',
          'margin-right': '5px',
          'background-position': 'center center',
          'background-repeat': 'no-repeat'
        },
        openerClass: ''
      },
      ignoreClass: 'clickable'
    };




    $('#sTree2, #sTree').sortableLists(options);


    var LearningActivity = function (uri, is_container)
    {
      this.name = "New Name";
      this.description = "";
      this.image =  "";
      this.uri =  uri;
      this.lom = null;
      this.pre_condition_rule  =  null;
      this.choice_exit = true;
      this.rollup_rule = "completed IF All completed";

      this.attempt_limit = 100;
      this.rollup_progress = true;
      this.available_from =  null;
      this.available_until = null;
      this.is_container = is_container;
      this.is_visible = true;
      this.rules = "";
    };





      learning_activities = [];
      rules_activities = [];

      //alert( {{ course_id }} );

      get_course();




     var course_root =  new LearningActivity( '/activity/'+'{{ course_id }}' ,true );
     learning_activities['{{ course_id }}']=course_root;




    // CREATE MODALS FROM TEMPLATES






    $('#saveChangesBtn').on('click', function(){
        var tree = tree_to_json( '#sTree2');



        $.ajax(   {
                    url: '/post_course',
                    type: "POST",
                    crossDomain: false, // obviates need for sameOrigin test
                    beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type)) {
                        var csrftoken = getCookie('csrftoken');
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                    },
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "post_course", "params": [tree],
                    "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {
                        alert('Changes are Saved');
                        get_course();
                        },
                    error: function(jqXHR, textStatus, errorThrown) {
                        }
                    });


    });

  function tree_to_json(id_selector){

       var order= 100;

       tree =  $(id_selector).sortableListsToHierarchy();



         function traverse(jsonObj) {
           if( typeof jsonObj == "object" ) {
              $.each(jsonObj, function(k,v) {

                if (typeof k == "number" && typeof v == "object")
                {
                  traverse(v);
                }
                if ( k == "id")
                {
                  jsonObj.learning_activity = learning_activities[v];
                  jsonObj.learning_activity.order_in_container = order++;

                }


                if ( k == "children" && typeof v == "object")
                {
                  traverse(v);

                }
              });
              }
              else
              {
                return;
                // jsonOb is a number or string
              }
           }

          traverse(tree);


         var course = [{
             "id": '{{ course_id }}',
             "order": 0,
             "children":tree,
             "learning_activity":learning_activities['{{ course_id }}'],
             "rules":rules_activities
            }];


          return JSON.stringify(course, null, 4);



  }


         //Export  button
  body.on('click', '#exportBtn', function(){
        var tree = tree_to_json( '#sTree2');
        var blob = new Blob( [tree] , {type: "application/json;charset=utf-8"});
        saveAs(blob, "course.json");
  });

function get_course() {


              //Wait.show();

              $.ajax(   {
                    url: '/get_course',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "get_course", "params": [{{ course_id }}],
                    "id": 1 }),
                   crossDomain: false, // obviates need for sameOrigin test
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type)) {
                            var csrftoken = getCookie('csrftoken');
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    },
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {
                            console.log("c:",data);

                            // Clear Main Conatainer
                            $('#sTree2').empty();
                            // Empty Array, please we must only reference this list with this name

                           learning_activities = [];

                            traverse(data);
                            update_ruleselect();

                           // Wait.hide();




                        },
                    error: function(jqXHR, textStatus, errorThrown) {

                        Wait.hide();

                        }
                    });





     function traverse(jsonObj,parent_id) {


        if( typeof jsonObj == "object" ) {


          $.each(jsonObj, function(k,v) {

            if (typeof k == "number" && typeof v == "object")
            {
              traverse(v, parent_id);
            }
            if ( k == "learning_activity")
            {
              //Extract the learning activity id
              var activity_id = v.id;
              jsonObj.id = activity_id;

              learning_activities[activity_id]=v;

              if ('{{ course_id }}' == activity_id )
                {

                      $("#course-title").html(learning_activities[activity_id].name + '  <small>'+ learning_activities[activity_id].uri  + '</small>') ;

                }




              if (v.is_container == true){
                  var container_template = $('#container_template').html();
                  Mustache.parse(container_template);
                  rendered = Mustache.render(container_template, { container_id:activity_id, container_name:v.name});


                  if (parent_id == '{{ course_id }}') {
                      $("#sTree2").append(rendered);

                  }
                  else
                  {

                    if ($("#" +parent_id).children("ul").length)
                    {
                      $("#" +parent_id).children("ul").append(rendered);

                    }
                    else
                    {
                     $("#" +parent_id).append("<ul></ul>");
                     $("#" +parent_id).children("ul").append(rendered);

                    }

                  }




                  if (jsonObj.children.length )
                  {
                  console.log("Before:");
                  console.log(jsonObj.children);
                  jsonObj.children.sort( function(a,b ){
                              return a.learning_activity.order_in_container - b.learning_activity.order_in_container;
                          }

                  );
                  console.log("After:");
                  console.log(jsonObj.children);
                  traverse(jsonObj.children,jsonObj.id);

                  }


                }
                else{

                  var activity_template = $('#activity_template').html();
                  Mustache.parse(activity_template);
                  rendered = Mustache.render(activity_template, { activity_id:activity_id, activity_name: v.name});

                if (parent_id == '{{ course_id }}') {
                  $("#sTree2").append(rendered);

                }
                else
                {
                  console.log(parent_id);

                  if ($("#" +parent_id).children("ul").length)
                  {
                    $("#" +parent_id).children("ul").append(rendered);

                  }
                  else
                  {
                    $("#" +parent_id).append("<ul></ul>");
                    $("#" +parent_id).children("ul").append(rendered);

                  }

                }



              }





            }


          });
        }
        else
        {
          return;
          // jsonOb is a number or string
        }
      }

      //traverse(tree);



    }



    $('#newContainerBtn').on('click', function(){
      var container_id = 'new-'+ generateUUID();
      var container_template = $('#container_template').html();
      Mustache.parse(container_template);

      var container = new LearningActivity( '/activity/'+container_id ,true );
      learning_activities[container_id]=container;
      learning_activities[container_id].state = "Added";

      rendered = Mustache.render(container_template, { container_id:container_id, container_name:container.name});
      $("#sTree2").append(rendered);
    });




    $('#newActivityBtn').on('click', function(){

      var activity_template = $('#activity_template').html();
      Mustache.parse(activity_template);
      var activity_id = 'new-'+generateUUID();
      var activity = new LearningActivity( "/activity/"+activity_id, false );
      learning_activities[activity_id]=activity;
      learning_activities[activity_id].state = "Added";



      rendered = Mustache.render(activity_template, { activity_id:activity_id, activity_name:"Activity Name"});
      $("#sTree2").append(rendered);
    });
  });



    $('body').on('click', '.deleteBtn', function(){


        if ($(this).parentsUntil('li').parent().children("ul").length ) {
            alert("Container must be empty for deletion");

        }
        else
        {
            var activity_to_delete = $(this).parentsUntil('li').parent().attr("id");
            alert("Delete:" + activity_to_delete + learning_activities[activity_to_delete] );
            learning_activities[activity_to_delete].state ="Deleted";
            $( this).parentsUntil('li').parent().addClass("hidden");
            rules_activities = $.grep(rules_activities,
                   function(o,i) { return o.applyto === activity_to_delete; },
                   true);

        }
    });


  $('body').on('click', '.activityEditBtn', function(){

    var container_id  = $( this).parentsUntil('li').parent().attr("id");

    var learning_activity = learning_activities[container_id];

    $('#activityURI').val(container_id);
    $('#maxAttempts').val(learning_activity.attempt_limit);

    if (learning_activity.choice_exit)
      {

        $('#activityExitCb').prop("checked",true);

      }
      else{
        $('#activityExitCb').prop("checked",false);
      }



    $('#activityRollupProgressCb').val(learning_activity.secondary_text);



    $('#modalActivity').modal();

  });

  $('body').on('click','#saveActivityBtn',function (e) {
    var container_id  = $('#activityURI').val();


    learning_activities[container_id].attempt_limit = $('#maxAttempts').val();



    if ( $('#activityRollupProgressCb').prop("checked") == true)
    {
      learning_activities[container_id].rollup_progress = true;
    }
    else
    {
      learning_activities[container_id].rollup_progress = false;
    }

    if ( $('#activityExitCb').prop("checked") == true)
    {
      learning_activities[container_id].choice_exit = true;
    }
    else
    {
      learning_activities[container_id].choice_exit = false;
    }



    $('#modalActivity').modal('hide');


  });



    $('body').on('click', '.containerEditBtn', function(){

        var container_id  = $( this).parentsUntil('li').parent().attr("id");

        containerEdit(container_id);

    });



    $('body').on('click', '#courseSettingsBtn', function(){



        containerEdit('{{ course_id }}');

    });



    function containerEdit (container_id)
    {
      var learning_activity = learning_activities[container_id];

      if (learning_activity.is_container == true)
      {
        $("#modalContainer").find(".modal-title").text("Edit Container");
      }
      else{
        $("#modalContainer").find(".modal-title").text("Edit Activity");

      }

      $('#containerName').val(learning_activity.name);
      $('#containerDescription').val(learning_activity.description);
      $('#containerImage').val(learning_activity.image);
      $('#containerId').val(container_id);
      $('#changeURI').val(learning_activity.uri);


      $('#container_image').attr("src",learning_activity.uri);

      if (learning_activity.is_visible)
      {

        $('#containerIsVisible').prop("checked",true);

      }
      else{
        $('#containerIsVisible').prop("checked",false);
      }

      $('#modalContainer').modal();

    }

    $('body').on('click','#saveContainerEditBtn',function (e) {

      var container_id  = $('#containerId').val();
      learning_activities[container_id].name = $('#containerName').val();
      learning_activities[container_id].description=$('#containerDescription').val();
      learning_activities[container_id].image=$('#containerImage').val();
      learning_activities[container_id].uri =  $('#changeURI').val();


      if ( $('#containerIsVisible').prop("checked") == true)
      {
        learning_activities[container_id].is_visible = true;
      }
      else
      {
        learning_activities[container_id].is_visible = false;
      }

      if   ('{{ course_id }}' == container_id ) //is root container ?
      {
            $("#course-title").html(learning_activities[container_id].name + '  <small>'+ learning_activities[container_id].uri  + '</small>'        );
      }
      else
      {

      var escaped_container_id = "#" + container_id.replace( "/", "\\/" );

      $(escaped_container_id).find('.container_name').first().text(learning_activities[container_id].name);

      }
      update_ruleselect();
      $('#modalContainer').modal('hide');

    });




  $('body').on('click', '.containerFromUntil', function(){


    var container_id  = $( this).parentsUntil('li').parent().attr("id");
    var learning_activity = learning_activities[container_id];


    $('#available-from').val(learning_activity.available_from);
    $('#available-until').val(learning_activity.available_until);
    $('#FromUntilURI').val(container_id);


    $('#available-from').datepicker({
      autoclose: true
    });
    $('#available-until').datepicker({
      autoclose: true
    });

    if (learning_activity.is_container == true)
    {
      $("#modalFromUntil").find(".modal-title").text("Edit Container");
    }
    else{
      $("#modalFromUntil").find(".modal-title").text("Edit Activity");

    }


    $('#modalFromUntil').modal();


  });


  $('body').on('click','#saveFromUntilBtn',function (e) {

    var container_id  = $('#FromUntilURI').val();
    learning_activities[container_id].available_from = $('#containerName').val();
    learning_activities[container_id].available_until =  $('#containerSecondaryText').val();

    $('#modalFromUntil').modal('hide');


  });


  $('body').on('click', '.containerPrecondition', function(){

    var container_id  = $( this).parentsUntil('li').parent().attr("id");
    var learning_activity = learning_activities[container_id];
    $("#modal-rulebuilder").find(".modal-title").text("Rule Builder - " + learning_activity.name);
    $("#container_rule_id").val(container_id);
      if (learning_activity.rules == ''){
          rules = '';
          conditions = [];
          $("#rules-body").empty();
          $("#modal-rulebuilder").modal()
      }
      else{
          try{
              rules = JSON.parse(learning_activity.rules);
              if (rules['conditions'] == undefined){
                  conditions = [];
              }
              else{
                  conditions = rules['conditions'];
                  $("#deleteAllbtn").prop("disabled", false);
              }
              populate_conditions(rules, container_id);
          }
          catch(error){
              console.log(error)
          }
      }

  });


  $('body').on('click','#savePreconditionBtn',function (e) {
      var container_id  = $('#PreconditionURI').val();
      var editor = ace.edit("editor1");

      //learning_activities[container_id].pre_condition_rule = editor.getValue();
      console.log(learning_activities[container_id]);
      $('#modalPrecondition').modal('hide');


  });


  $('body').on('click', '.containerRollup', function(){


    var container_id  = $( this).parentsUntil('li').parent().attr("id");
    var learning_activity = learning_activities[container_id];
    $('#containerRollupRule').val(learning_activity.rollup_rule );
    $('#rollupURI').val(container_id);

    if (learning_activity.is_container == true)
    {
      $("#modalRollup").find(".modal-title").text("Edit Container");
    }
    else{
      $("#modalRollup").find(".modal-title").text("Edit Activity");

    }

    if (learning_activity.rollup_progress)
    {

      $('#rollupProgressCb').prop("checked",true);

    }
    else{

      $('#rollupProgressCb').prop("checked",false);
    }


    $('#modalRollup').modal()


  });


  $('body').on('click','#saveRollupBtn',function (e) {

    var container_id  = $('#rollupURI').val();
    learning_activities[container_id].rollup_rule = $('#containerRollupRule').val();

    if ( $('#rollupProgressCb').prop("checked") == true)
    {
      learning_activities[container_id].rollup_progress = true;
    }
    else
    {
      learning_activities[container_id].rollup_progress = false;
    }
        $('#modalRollup').modal('hide');


  });

  $('body').on('click', '#courseDeleteBtn', function(){

    $('#modalDeleteCourse').modal();


  });

  $('body').on('click', ".containerSearch", function(){
      container_id  = $( this).parentsUntil('li').parent().attr("id");
      $("#modalSearch").modal()
  });

//rule builder modal options
  $(document).ready(function(){
      $(window).load(function() {
          $('#context-time').timepicker({
              minuteStep: 1,
              secondStep: 5,
              showInputs: false,
              showSeconds: true,
              showMeridian: false
          });
      });
  });

  var body = $('body');

  body.on('hidden.bs.modal', '#modal-rulebuilder', function(){
      rules = '';
      conditions = [];
      $('.selection').prop('selectedIndex',0);
      $('#activity-txt, #context-txt').show();
      $('#activity-value-select, #context-value-select, #contextime').hide();
      $("#context-operators").prop('disabled', true);
      $("#activity-operators").prop('disabled', false);
      $("#deleteAllbtn").prop("disabled", true);
  });

  body.on('click','#usertab', function(){
      $("#userdiv").slideToggle('fast',function(){
      })
  });

  body.on('click','#activitytab', function(){
      $("#activitydiv").slideToggle('fast',function(){
      })
  });

  body.on('click','#contexttab', function(){
      $("#contextdiv").slideToggle('fast',function(){
      })
  });

  body.on('change', "#activity-options", function(){
      if ($(this).val() == "progress_status"){
          $("#activity-value-select").show();
          $("#activity-txt").hide();
          $("#activity-operators").val("==").prop('disabled', true);
      }
      else{
          $("#activity-value-select").hide();
          $("#activity-txt").show();
          $("#activity-operators").val("==").prop('disabled', false);
      }
  });

  //validates numeric fields
  body.on('change', "#activity-txt", function(){
      var regex = /^[0-9]*(?:\.\d{1,2})?$/;    // allow only numbers [0-9]
      if( !regex.test( $(this).val()) ) {
          $(this).popover({
              title: "Error",
              content: "Only numbers accepted",
              placement: 'top'
          });
          $(this).popover('show');
          $("#activity-submit").prop('disabled', true);
      }
      else{
          $(this).popover('destroy');
          $("#activity-submit").prop('disabled', false);
      }
  });

  body.on('change', "#context-options", function(){
      if ($(this).val() == "dayof"){
          $("#context-value-select").show();
          $("#context-txt, #contextime").hide();
          $("#context-operators").val("==").prop('disabled', true);
      }
      else if ($(this).val() == "time"){
          $("#context-value-select, #context-txt").hide();
          $("#contextime").show();
          $("#context-operators").val("==").prop('disabled', false);
      }
      else{
          $("#context-value-select, #contextime").hide();
          $("#context-txt").show();
          $("#context-operators").val("==").prop('disabled', true);
      }
  });

  //deletes rule but does not save til user click Save Changes button
  body.on('click', '#uploadBtn', function(){
    $('#upload').modal('show')
  });



  //deletes rule but does not save til user click Save Changes button
  body.on('click', '#deleteAllbtn', function(){
      $("#rule").remove();
      rules = '';
      conditions = [];
      $(this).prop("disabled",true);
  });

  //fired when user adds a rule using Add Rule
  body.on('click', '.submit-Btn' ,function(){
      var btntype = $(this).attr('id').split('-')[0];
      var act_name = $('#activity-select option:selected').html();
      var uri = ($('#activity-select option:selected').attr('uri'));
      var activity_id=$("#activity-select").val();
      var container_id= $("#container_rule_id").val();
      if (btntype == 'activity'){
          var option = $('#activity-options').val();
          var option_txt = $('#activity-options option:selected').html();
          var operator = $("#activity-operators").val();
          var operator_text = $("#activity-operators option:selected").html();
          if ($("#activity-value-select").is(":visible")){
              var value = $("#activity-value-select").val();
          }
          else{
              var txt = $("#activity-txt");
              value = txt.val();
              if (value == ''){
                  txt.popover({
                      title: "Error",
                      content: "Submit a numeric value",
                      placement: 'top'
                  });
                  txt.popover('show');
                  return false;
              }
          }
          $("#"+btntype+"-txt").val('');
      }
      else if (btntype == 'user'){
          var user = true;
          txt = $("#user-txt");
          option = $('#user-options').val();
          option_txt = $('#user-options option:selected').html();
          operator = $("#user-operators").val();
          operator_text = $("#user-operators option:selected").html();
          value = txt.val();
          if (value == ''){
              txt.popover({
                  title: "Error",
                  content: "Submit value",
                  placement: 'top'
              });
              txt.popover('show');
              return false;
          }
          txt.val('');
      }
      else if (btntype == 'context'){
          var context = true;
          option = $('#context-options').val();
          option_txt = $('#context-options option:selected').html();
          operator = $("#context-operators").val();
          operator_text = $("#context-operators option:selected").html();
          if ($("#context-value-select").is(":visible")){
              value = $("#context-value-select").val();
          }
          else if ($("#contextime").is(":visible")){
              value = $("#context-time").val();
              $("#context-time").val('00:00:00');
          }
          else{
              txt = $("#context-txt");
              value = txt.val();
              if (value == ''){
              txt.popover({
                  title: "Error",
                  content: "Submit value",
                  placement: 'top'
              });
              txt.popover('show');
              return false;
              }
          }
          $("#"+btntype+"-txt").val('');
      }

      if ($.isPlainObject(rules)){
          //pass
      }
      else{
          rules = {'id': activity_id, 'conditions':conditions, 'applyto': container_id , 'operator':'and'};
      }
      var id = Math.random().toString(36).substr(2, 5);
      var condition = {'id':id,'uri':uri, 'act_name':act_name ,'option':option,'option_txt':option_txt,'operator':operator,'operator_txt':operator_text,'value':value};
      $("#rule").remove();
      if (user == true){
          condition['user']='true'
      }
      else if (context == true){
          condition['context'] = 'true'
      }
      conditions.push(condition);
      populate_conditions(rules, container_id);
      $("#deleteAllbtn").prop("disabled",false);
  });

  //deletes individual rule/condition, but does not save til user click Save Changes button
  body.on('click', '.deleteRuleBtn', function(){
      var container = $(this).attr("condition-id");
      $("#"+container).remove();
      var index = rules.conditions.map(function(e) { return e.id; }).indexOf(container);
      rules.conditions.splice(index,1);
      if (rules.conditions.length == 0){
          $("#rule").remove();
          rules = '';
          $("#deleteAllbtn").prop("disabled", true);
      }
    });

  //saves selected precondition in rule
  body.on('change', '.selectThen', function(){
      var container_id = $("#container_rule_id").val();
      rules['precondition'] = $(this).val();
      populate_conditions(rules, container_id);
  });

  //saves rules in its learning activity
  body.on('click',"#save-rules",function(){
      var precondition = $("#precondition-select");
      if (precondition.length != 0 && precondition.val()==""){
          alert("Select a Precondition");
      }
      else{
          rule_builder();
          $("#modal-rulebuilder").modal('hide');
      }
  });

  //updates activity select dropdownlist with the different activities in the course (learning_activities)
  function update_ruleselect(){
      $("body #activity-select").empty();
      if (learning_activities.length != 0) {
              $.each(learning_activities, function (index, value) {
                  if (typeof value === 'undefined' || value.root_id == null) return;
                  $("body #activity-select").append($("<option></option>")
                          .attr("value", value.id)
                          .attr("uri", value.uri)
                          .text(value.name));
              })
          }
  }

  //saves or clear precondition_rule, if user deleted the rule, the fields are emptied
  function rule_builder(){
      var container = $("#container_rule_id").val();
      if (jQuery.type(rules) != 'object'){
          rules = '';
          learning_activities[container].pre_condition_rule = rules;
          learning_activities[container].rules = rules;
      }
      else{
          rules['applyto'] = container;
          learning_activities[container].pre_condition_rule = JSON.stringify(rules);
          learning_activities[container].rules = JSON.stringify(rules);
          rules = '';
      }

  }

  //receives a rule and container_id, and populates it on modal rulebuilder
  function populate_conditions(regla, container_id){
      $("#rules-body").empty();
      Mustache.tags = ['[[', ']]'];
      var rules_template = $('#rules_template').html();
      Mustache.parse(rules_template);
      rendered = Mustache.render(rules_template, {
          condiciones: regla.conditions,
          user: regla.user,
          container_id: regla.applyto,
          then: regla.precondition
      });
      $("#rules-body").append(rendered);
      $("#precondition-select option[value="+regla.precondition+"]").prop("selected", "selected");
      $("#modal-rulebuilder").modal()

  }



//
  //change action for search textbox, determines if the input is a tag or just a title search
  $("body").on('change', "#txtname", function(){
      $("#data").empty();
      var query = {};
      var name = $(this).val();
      var exp_tags = /S*#(?:\[[^\]]+\]|\S+)/;
      if (exp_tags.test(name)){
          var texto = name.split(/\s+/g);
          tags = [];
          title = [];
          for(var i=0;i<texto.length;i++){
              if(texto[i].match(exp_tags)){
                  tags.push(texto[i].replace('#',''))
              }
              else{
                  title.push(texto[i])
              }
          }
          title = title.join(" ");
          if (title != "" && tags.length != 0){
              query['title'] = {'title': {'$regex': title, '$options': 'i'}};
              query['tags'] = {'tags': {'$all': tags}};
          }
          else if (tags.length != 0 && title == ""){
              query['tags'] = {'tags': {'$all': tags}};
              delete query['title']
          }
          else if (tags.length == 0 && title != ""){
              query['title'] = {'title': {'$regex': title, '$options': 'i'}};
              delete query['tags']
          }
          else{
              delete query['title'];
              delete query['tags']
          }
          buscar(query)
      }
      else {
          query['title'] = {'title': {'$regex': $("#txtname").val(), '$options': 'i'}};
          delete query['tags'];
          buscar(query)
      }

  });

  $("body").on("hidden.bs.modal", '#modalSearch' ,function(){
            $("#txtname").val('');
            $("#data").empty()
        });

  //ajax function that sends query to server and display results to user
  function buscar(tipo){
        $.ajax({
        type: 'POST',
        url: '/search_prueba',
        crossDomain: false, // obviates need for sameOrigin test
        beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type)) {
                        var csrftoken = getCookie('csrftoken');
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                },

        data: JSON.stringify(tipo),
        success: function (data) {
            var obj = jQuery.parseJSON( data );
            if (obj == "null" || obj[0].count == 0){
                $("#data").append('<h3 style="color:lightgray">No hay actividades</h3><br>');
                count = 0
            }
            else{
                Mustache.tags = ['[[', ']]'];
                var activities_template = $('#activities_template').html();
                Mustache.parse(activities_template);
                $.each(obj, function( index, value ) {
                if (value.count){
                        var count = value.count
                    }
                    else{
                        rendered = Mustache.render(activities_template, {
                            title: value.title,
                            id: value._id,
                            icon:value.icon,
                            description: value.description,
                            lang:value.lang,
                            level:value.level,
                            type:value.type,
                            tags:value.tags});
                        $("#data").append(rendered);
                    }

            });

            $('#data').val(data);
            }

        },
        error: function(data) {
            console.log("Error");
        }
    });
    }

    function copyUri(id,title){
        learning_activities[container_id].name = title;
        learning_activities[container_id].uri = id;
        containerEdit(container_id);
        $("#modalSearch").modal('hide')

    }


function uploadFile() {
  var xhr = new XMLHttpRequest();
  var fd = new FormData(document.getElementById('uploadForm')) ;
  /* event listners */
  xhr.upload.addEventListener("progress", uploadProgress, false);
  xhr.addEventListener("load", uploadComplete, false);
  xhr.addEventListener("error", uploadFailed, false);
  xhr.addEventListener("abort", uploadCanceled, false);
  /* Be sure to change the url below to the url of your upload server side script */
  xhr.open("POST", "/upload_course");
  /*Course ID SET IN the Server Side*/
  fd.set("course_id","{{ course_id }}")
  xhr.send(fd);
       }
     function uploadProgress(evt) {
            if (evt.lengthComputable) {
       var percentComplete = Math.round(evt.loaded * 100 / evt.total);
            document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '%';
             }
            else {
            document.getElementById('progressNumber').innerHTML = 'unable to compute';
            }
    }
function uploadComplete(evt) {
  /* This event is raised when the server send back a response */
  alert(evt.target.responseText);
}
function uploadFailed(evt) {
  alert("There was an error attempting to upload the file.");
}
function uploadCanceled(evt) {
  alert("The upload has been canceled by the user or the browser dropped the connection.");
}



function fileSelected() {
      var file = document.getElementById('fileToUpload').files[0];
      if (file) {
        var fileSize = 0;
        if (file.size > 1024 * 1024)
          fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
        else
          fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';
        document.getElementById('fileName').innerHTML = 'Name: ' + file.name;
        document.getElementById('fileSize').innerHTML = 'Size: ' + fileSize;
        document.getElementById('fileType').innerHTML = 'Type: ' + file.type;

        if (file.size < 1024 * 1024) {
          $("#uploadFileBtn").prop("disabled", false);
          console.log("Not to big");
          }
        else
        {
            console.log(file.size);
        }
        }
     }


</script>


<div class="modal fade" id="modalContainer">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Edit Container</h4>
      </div>


      <div class="modal-body">
        <div class="form-group">
          <input type="text" class="form-control hidden" id="containerId" placeholder="" required pattern="https?://.+" disabled>
        </div>

        <div class="form-group">
          <label for="changeURI">URL</label>
          <input type="text" class="form-control" id="changeURI" placeholder="" required pattern="https?://.+" >
        </div>

        <div class="form-group">
          <label for="containerName">Display Name</label>
          <input type="text" class="form-control" id="containerName" placeholder="Container Name">
        </div>


        <div class="form-group">
          <label for="containerDescription">Description</label>
          <textarea class="form-control" id="containerDescription" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="containerImage">Image URL</label>
          <input type="url" class="form-control" id="containerImage" placeholder="" required pattern="https?://.+">

        </div>
        <div class="row">

          <img id="container_image" src="http://img.src.ca/2014/07/03/635x357/140703_pg6ew_mlarge_obession_performance_sn635.jpg" alt="..." class="img-rounded fixed-small center-block">

        </div>





        <div class="form-group">
          <div class="checkbox">
            <label> <input id="containerIsVisible" type="checkbox"> Visible </label>
          </div>
        </div>

      </div><!-- /.modal-body -->


      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="saveContainerEditBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade bs-example-modal-lg" id="modalPrecondition">
  <div class="modal-dialog modal-lg ">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Edit Container</h4>
      </div>


      <div class="modal-body">

        <div class="form-group">

          <input type="url" class="form-control hidden" id="PreconditionURI" placeholder="" required pattern="https?://.+" disabled>
        </div>

        <div class="form-group">
            <label for="editor1">Precondition Rule</label>
            <div class="myeditor" id="editor1">

            </div>
        </div>


      </div><!-- /.modal-body -->



      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="savePreconditionBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>



    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modalFromUntil">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Edit Container</h4>
      </div>


      <div class="modal-body">

        <div class="form-group">

          <input type="url" class="form-control hidden" id="FromUntilURI" placeholder="" required pattern="https?://.+" disabled>
        </div>


        <div class="form-group">
          <label for="available-from">Available from</label>
          <div id ="available-from" class="input-group date">
            <input type="text" class="form-control"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
          </div>
        </div>




        <div class="form-group">
          <label for="available-until">Available until</label>
          <div id ="available-until" class="input-group date">
            <input type="text" class="form-control"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
          </div>
        </div>

      </div><!-- /.modal-body -->



      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="saveFromUntilBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>



    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modalRollup">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Edit Container</h4>
      </div>


      <div class="modal-body">
        <div class="form-group">

          <input type="url" class="form-control hidden" id="rollupURI" placeholder="" required pattern="https?://.+" disabled>
        </div>

        <div class="form-group">
          <label for="containerRollupRule">Rollup Rule</label>
          <textarea class="form-control" id="containerRollupRule" rows="3"></textarea>
        </div>

        <div class="form-group">
          <div class="checkbox">
            <label> <input id="rollupProgressCb" type="checkbox"> Rollup Progress </label>
          </div>
        </div>

      </div><!-- /.modal-body -->



      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="saveRollupBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>



    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="modal fade" id="modalActivity">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Edit Activity</h4>
      </div>


      <div class="modal-body">
        <div class="form-group">

          <input type="url" class="form-control hidden" id="activityURI" placeholder="" required pattern="https?://.+" disabled>
        </div>

        <div class="form-group">
          <label for="maxAttempts">Attempt Limit</label>
          <input type="url" class="form-control" id="maxAttempts" placeholder="" required pattern="https?://.+" >
        </div>


        <div class="form-group">
          <div class="checkbox">
            <label> <input id="activityRollupProgressCb" type="checkbox"> Rollup Progress </label>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox">
            <label> <input id="activityExitCb" type="checkbox"> Choice Exit   </label>
          </div>
        </div>


      </div><!-- /.modal-body -->

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="saveActivityBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>



    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

 <div class="modal fade" id="modalDeleteCourse">
  <div class="modal-dialog">
    <div class="modal-content">
       <form action="/delete_course/{{ course_id }}" method="post">{% csrf_token %}
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Delete Course</h4>
      </div>


      <div class="modal-body">
          <h4>Please confirm, all data will be deleted!</h4>



      </div><!-- /.modal-body -->


      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="createCourseBtn" type="submit" class="btn btn-danger">Delete</button>
      </div>
           </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="modal fade" id="modalSearch">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search Activity</h4>
      </div>
       <div class="container" style="width: 70%">
           <br>
           <form id="formSearch" onsubmit="return false">
           <div class="input-group">
               <input type="text" class="form-control" placeholder="Search by Title or #Tag" id="txtname">
               <div class="input-group-btn">
                   <button class="btn btn-default" type="submit" style="background-color: #4285F4"><i class="fa fa-search" style="color: white"></i></button>
               </div>
           </div>
           </form>
           <br>
       </div>
        <div id="data" align="center">

        </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>


    <div class="modal fade" id="modal-rulebuilder">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Rule Builder</h4>
                </div>
                <div id="rulebuilder" align="center">
                        <div class="well well-sm" style="border: hidden">
                            <a class="panel-title" id="activitytab">Activity<span class="caret"></span></a>
                            <input type="hidden" id="container_rule_id" value="">
                            <div id="activitydiv"><br>
                                <label for="activity-select">Activity</label>
                                <select id="activity-select" class="form-control selection" style="width:20%">

                                </select><br>
                                <div class="form-inline">
                                    <select class="form-control selection" id="activity-options" style="width:20%">
                                        <option value="num_attempts">Attempts</option>
                                        <option value="progress_status">Progress</option>
                                        <option value="objective_measure">Objective Measure</option>
                                    </select>

                                    <select class="form-control selection" id="activity-operators" style="width:20%">
                                        <option value="==">Equals</option>
                                        <option value=">">More than</option>
                                        <option value="<">Less than</option>
                                        <option value="!=">Different than</option>
                                    </select>

                                    <input type="text" class="form-control" id="activity-txt" placeholder="Value" style="width:20%">

                                    <select class="form-control selection" id="activity-value-select" style="display:none;width:20%">
                                        <option value="completed">Completed</option>
                                        <option value="incomplete">Incomplete</option>
                                    </select>

                                    <input type="button" id="activity-submit" class="form-control btn-primary submit-Btn" value="Add Rule">
                                </div>
                            </div><br>
                        </div>
                    <div class="well well-sm">
                            <a class="panel-title" id="usertab">User<span class="caret"></span></a>
                            <div id="userdiv" style="display:none"><br>
                                <div class="form-inline">
                                    <select class="form-control selection" id="user-options" style="width:20%">
                                        <option value="level">Level</option>
                                        <option value="points">Points</option>
                                        <option value="experience">Experience</option>
                                        <option value="tag">Tag</option>
                                    </select>

                                    <select class="form-control selection" id="user-operators" style="width:20%">
                                        <option value="==">Equals</option>
                                        <option value=">">More than</option>
                                        <option value="<">Less than</option>
                                        <option value="!=">Different than</option>
                                    </select>

                                    <input type="text" class="form-control" id="user-txt" placeholder="Value" style="width:20%">

                                    <input type="button" id="user-submit" class="form-control btn-primary submit-Btn" value="Add Rule">
                                </div>
                            </div><br>
                    </div>

                    <div class="well well-sm" style="border: hidden">
                            <a class="panel-title" id="contexttab">Context<span class="caret"></span></a>
                            <div id="contextdiv" style="display:none"><br>
                                <div class="form-inline">
                                    <select class="form-control selection" id="context-options" style="width:20%">
                                        <option value="device">Device</option>
                                        <option value="place">Place</option>
                                        <option value="time">Time</option>
                                        <option value="dayof">Day of Week</option>
                                    </select>

                                    <select class="form-control selection" id="context-operators" disabled style="width:20%">
                                        <option value="==">Equals</option>
                                        <option value=">">More than</option>
                                        <option value="<">Less than</option>
                                        <option value="!=">Different than</option>
                                    </select>

                                    <select class="form-control selection" id="context-value-select" style="display:none;width:20%">
                                        <option value="monday">Monday</option>
                                        <option value="tuesday">Tuesday</option>
                                        <option value="wednesday">Wednesday</option>
                                        <option value="thursday">Thursday</option>
                                        <option value="friday">Friday</option>
                                        <option value="saturday">Saturday</option>
                                        <option value="sunday">Sunday</option>
                                    </select>

                                    <div id="contextime" class="input-group bootstrap-timepicker timepicker" style="width:20%;display:none">
                                        <input id="context-time" type="text" value="12:00 PM" class="form-control input-small">
                                        <span class="input-group-addon"><i class="fa fa-clock-o" aria-hidden="true"></i></span>
                                    </div>

                                    <input type="text" class="form-control" id="context-txt" placeholder="Value" style="width:20%">

                                    <input type="button" id="context-submit" class="form-control btn-primary submit-Btn" value="Add Rule">
                                </div>
                            </div><br>
                    </div>
                    <div id="rules-display" class="panel panel-default" style="width:90%">
                        <div class="panel-heading" style="padding:15px 15px !important;"><span style="position: relative;left:40px;font-size: medium">Conditions</span>  <button class="btn btn-danger" disabled type="button" id="deleteAllbtn" style="float:right;position: relative;top:-5px">Delete All</button>  </div>
                        <div id="rules-body" class="panel-body">

                        </div>
                    </div>
                    <div class="modal-footer" id="rulebuilder-footer">
                        <input type="button" class="btn btn-primary" id="save-rules" value="Save Rules">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>



<div class="modal fade" id="upload">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Upload Course</h4>
      </div>
      <div class="modal-body">

  <form id="uploadForm" enctype="multipart/form-data" method="post" action="upload" accept-charset="UTF-8">
  <div class="form-group">
    <label for="formGroupExampleInput">Select a File to Upload</label>
    <input type="file" name="fileToUpload" class="form-control" id="fileToUpload" onchange="fileSelected()">
  </div>
    <div id="fileName"></div>
    <div id="fileSize"></div>
    <div id="fileType"></div>
    <div id="progressNumber"></div>
</form>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button id="uploadFileBtn" type="button" class="btn btn-primary" onclick="uploadFile()" disabled >Upload</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


{% endblock scripts %}












